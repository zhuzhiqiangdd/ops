# AnsibleåŸºç¡€æ¦‚å¿µ

## ç‰ˆæœ¬ä¿¡æ¯
- ç‰ˆæœ¬å·: v1.0.0
- æ›´æ–°æ—¥æœŸ: 2024-03-21
- çŠ¶æ€: [ğŸ—ï¸è¿›è¡Œä¸­]

## 1. æ¦‚è¿°
æœ¬æ–‡æ¡£ä¸»è¦ä»‹ç»Ansibleè‡ªåŠ¨åŒ–è¿ç»´å·¥å…·çš„åŸºç¡€æ¦‚å¿µå’Œæ ¸å¿ƒç»„ä»¶ã€‚

## 2. ä»€ä¹ˆæ˜¯Ansible
Ansibleæ˜¯ä¸€ä¸ªå¼€æºçš„è‡ªåŠ¨åŒ–è¿ç»´å·¥å…·ï¼Œä¸»è¦ç”¨äºé…ç½®ç®¡ç†ã€åº”ç”¨éƒ¨ç½²ã€ä»»åŠ¡æ‰§è¡Œç­‰ITè‡ªåŠ¨åŒ–éœ€æ±‚ã€‚å…¶ä¸»è¦ç‰¹ç‚¹åŒ…æ‹¬ï¼š
- æ— ä»£ç†æ¶æ„
- åŸºäºSSHé€šä¿¡
- ä½¿ç”¨YAMLè¯­æ³•
- æ¨¡å—åŒ–è®¾è®¡
- å¹‚ç­‰æ€§æ“ä½œ

## 3. æ ¸å¿ƒæ¦‚å¿µ
### 3.1 Inventoryï¼ˆæ¸…å•ï¼‰
```ini
[webservers]
web1.example.com
web2.example.com

[dbservers]
db1.example.com
db2.example.com

[webservers:vars]
http_port=80
```

### 3.2 Playbookï¼ˆå‰§æœ¬ï¼‰
```yaml
---
- name: Install and configure web server
  hosts: webservers
  become: yes
  tasks:
    - name: Install nginx
      apt:
        name: nginx
        state: present
    
    - name: Start nginx service
      service:
        name: nginx
        state: started
        enabled: yes
```

### 3.3 Roleï¼ˆè§’è‰²ï¼‰
```
roles/
  webserver/
    tasks/
      main.yml
    handlers/
      main.yml
    templates/
      nginx.conf.j2
    vars/
      main.yml
    defaults/
      main.yml
    meta/
      main.yml
```

## 4. åŸºç¡€ç»„ä»¶
### 4.1 æ¨¡å—(Modules)
- å‘½ä»¤æ¨¡å—ï¼šcommand, shell, raw
- æ–‡ä»¶æ¨¡å—ï¼šcopy, file, template
- åŒ…ç®¡ç†ï¼šapt, yum, pip
- ç³»ç»Ÿæ¨¡å—ï¼šservice, user, group
- äº‘å¹³å°ï¼šaws, azure, gcp

### 4.2 å˜é‡(Variables)
- ä¸»æœºå˜é‡
- ç»„å˜é‡
- å…¨å±€å˜é‡
- æ³¨å†Œå˜é‡
- äº‹å®å˜é‡

### 4.3 æ¡ä»¶å’Œå¾ªç¯
```yaml
- name: Install packages
  apt:
    name: "{{ item }}"
    state: present
  loop:
    - nginx
    - mysql-server
    - php-fpm
  when: ansible_distribution == 'Ubuntu'
```

## 5. æ‰§è¡Œæ§åˆ¶
### 5.1 å¤„ç†å™¨(Handlers)
```yaml
tasks:
  - name: Copy nginx configuration
    copy:
      src: nginx.conf
      dest: /etc/nginx/nginx.conf
    notify: restart nginx

handlers:
  - name: restart nginx
    service:
      name: nginx
      state: restarted
```

### 5.2 æ ‡ç­¾(Tags)
```yaml
tasks:
  - name: Install nginx
    apt:
      name: nginx
      state: present
    tags: 
      - install
      - nginx
```

## 6. é…ç½®æ–‡ä»¶
### 6.1 ansible.cfg
```ini
[defaults]
inventory = ./inventory
remote_user = ansible
private_key_file = ~/.ssh/id_rsa
host_key_checking = False

[privilege_escalation]
become = True
become_method = sudo
become_user = root
become_ask_pass = False
```

### 6.2 ä¸»æœºæ¸…å•æ ¼å¼
```ini
# é™æ€ä¸»æœºæ¸…å•
[webservers]
web[1:3].example.com

# åŠ¨æ€ä¸»æœºæ¸…å•
[dbservers]
db-[a:c].example.com ansible_host=10.0.0.[1:3]
```

## 7. æœ€ä½³å®è·µ
### 7.1 ç›®å½•ç»“æ„
```
project/
â”œâ”€â”€ ansible.cfg
â”œâ”€â”€ inventory/
â”‚   â”œâ”€â”€ production
â”‚   â””â”€â”€ staging
â”œâ”€â”€ group_vars/
â”‚   â”œâ”€â”€ all.yml
â”‚   â””â”€â”€ webservers.yml
â”œâ”€â”€ host_vars/
â”‚   â””â”€â”€ web1.yml
â”œâ”€â”€ roles/
â”‚   â”œâ”€â”€ common/
â”‚   â””â”€â”€ webserver/
â””â”€â”€ site.yml
```

### 7.2 å‘½åè§„èŒƒ
- ä½¿ç”¨æœ‰æ„ä¹‰çš„åç§°
- ä¿æŒä¸€è‡´çš„å‘½åé£æ ¼
- ä½¿ç”¨å°å†™å­—æ¯å’Œä¸‹åˆ’çº¿
- é¿å…ä½¿ç”¨ç‰¹æ®Šå­—ç¬¦

## 8. å¸¸è§é—®é¢˜
### 8.1 è¿æ¥é—®é¢˜
- SSHå¯†é’¥é…ç½®
- é˜²ç«å¢™è®¾ç½®
- æƒé™é—®é¢˜

### 8.2 æ‰§è¡Œé—®é¢˜
- æ¨¡å—ä¾èµ–
- Pythonç‰ˆæœ¬
- ç³»ç»Ÿå…¼å®¹æ€§

## 9. å‚è€ƒèµ„æ–™
1. [Ansibleå®˜æ–¹æ–‡æ¡£](https://docs.ansible.com/)
2. [Ansibleæœ€ä½³å®è·µ](https://docs.ansible.com/ansible/latest/user_guide/playbooks_best_practices.html)
3. [Ansible Galaxy](https://galaxy.ansible.com/) 