# Ansibleå®‰è£…é…ç½®æŒ‡å—

## ç‰ˆæœ¬ä¿¡æ¯
- ç‰ˆæœ¬å·: v1.0.0
- æ›´æ–°æ—¥æœŸ: 2024-03-21
- çŠ¶æ€: [ğŸ—ï¸è¿›è¡Œä¸­]

## 1. æ¦‚è¿°
æœ¬æ–‡æ¡£ä¸»è¦ä»‹ç»Ansibleçš„å®‰è£…æ–¹æ³•å’ŒåŸºç¡€é…ç½®ã€‚

## 2. ç¯å¢ƒè¦æ±‚
### 2.1 æ§åˆ¶èŠ‚ç‚¹è¦æ±‚
- Python 3.9+
- OpenSSH
- æ”¯æŒçš„æ“ä½œç³»ç»Ÿï¼š
  - Linux (Red Hat, Debian, Ubuntuç­‰)
  - macOS
  - Windows (WSL)

### 2.2 è¢«ç®¡ç†èŠ‚ç‚¹è¦æ±‚
- Python 2.7æˆ–Python 3.5+
- OpenSSHæœåŠ¡
- SFTPæœåŠ¡ï¼ˆæˆ–é…ç½®ä¸ºä½¿ç”¨SCPï¼‰

## 3. å®‰è£…æ–¹æ³•
### 3.1 åŒ…ç®¡ç†å™¨å®‰è£…
#### Ubuntu/Debian
```bash
# æ›´æ–°åŒ…ç´¢å¼•
sudo apt update

# å®‰è£…Ansible
sudo apt install ansible
```

#### RHEL/CentOS
```bash
# å¯ç”¨EPELä»“åº“
sudo yum install epel-release

# å®‰è£…Ansible
sudo yum install ansible
```

### 3.2 pipå®‰è£…
```bash
# å®‰è£…pip
sudo apt install python3-pip

# å®‰è£…Ansible
pip3 install ansible
```

### 3.3 æºç å®‰è£…
```bash
# å…‹éš†æºç 
git clone https://github.com/ansible/ansible.git

# åˆ‡æ¢åˆ°ç¨³å®šç‰ˆæœ¬
cd ansible
git checkout stable-2.9

# å®‰è£…ä¾èµ–
pip3 install -r requirements.txt

# è®¾ç½®ç¯å¢ƒå˜é‡
source ./hacking/env-setup
```

## 4. åŸºç¡€é…ç½®
### 4.1 é…ç½®æ–‡ä»¶ä½ç½®
- å…¨å±€é…ç½®ï¼š`/etc/ansible/ansible.cfg`
- é¡¹ç›®é…ç½®ï¼š`./ansible.cfg`
- ç”¨æˆ·é…ç½®ï¼š`~/.ansible.cfg`

### 4.2 åŸºç¡€é…ç½®ç¤ºä¾‹
```ini
[defaults]
# ä¸»æœºæ¸…å•æ–‡ä»¶è·¯å¾„
inventory = ./inventory

# è¿œç¨‹ç”¨æˆ·
remote_user = ansible

# SSHç§é’¥è·¯å¾„
private_key_file = ~/.ssh/id_rsa

# ç¦ç”¨SSHä¸»æœºå¯†é’¥æ£€æŸ¥
host_key_checking = False

# å¹¶è¡Œæ‰§è¡Œæ•°
forks = 5

# æ—¥å¿—è·¯å¾„
log_path = ./ansible.log

[privilege_escalation]
# æ˜¯å¦ä½¿ç”¨sudo
become = True
become_method = sudo
become_user = root
become_ask_pass = False

[ssh_connection]
# SSHå‚æ•°
ssh_args = -C -o ControlMaster=auto -o ControlPersist=60s

# ä½¿ç”¨SFTP
transfer_method = sftp

# ç®¡é“ä¼ è¾“
pipelining = True
```

## 5. ä¸»æœºæ¸…å•é…ç½®
### 5.1 é™æ€ä¸»æœºæ¸…å•
```ini
# åŸºæœ¬ä¸»æœºç»„
[webservers]
web1.example.com
web2.example.com ansible_host=192.168.1.101

# ä¸»æœºç»„å˜é‡
[webservers:vars]
http_port=80
proxy_port=8080

# åµŒå¥—ç»„
[production:children]
webservers
dbservers

# èŒƒå›´è¡¨ç¤º
[workers]
worker[01:50].example.com
```

### 5.2 åŠ¨æ€ä¸»æœºæ¸…å•
```python
#!/usr/bin/env python3
import json

def get_inventory():
    return {
        "webservers": {
            "hosts": ["web1.example.com", "web2.example.com"],
            "vars": {
                "http_port": 80
            }
        },
        "_meta": {
            "hostvars": {
                "web1.example.com": {
                    "ansible_host": "192.168.1.101"
                }
            }
        }
    }

if __name__ == '__main__':
    print(json.dumps(get_inventory()))
```

## 6. SSHé…ç½®
### 6.1 å¯†é’¥é…ç½®
```bash
# ç”ŸæˆSSHå¯†é’¥å¯¹
ssh-keygen -t rsa -b 4096

# åˆ†å‘å…¬é’¥
ssh-copy-id -i ~/.ssh/id_rsa.pub ansible@remote-host
```

### 6.2 SSHé…ç½®æ–‡ä»¶
```
# ~/.ssh/config
Host *.example.com
    User ansible
    IdentityFile ~/.ssh/id_rsa
    StrictHostKeyChecking no
    UserKnownHostsFile /dev/null
```

## 7. æƒé™é…ç½®
### 7.1 sudoé…ç½®
```bash
# /etc/sudoers.d/ansible
ansible ALL=(ALL) NOPASSWD: ALL
```

### 7.2 becomeé…ç½®
```yaml
- name: Execute task with sudo
  hosts: all
  become: yes
  become_method: sudo
  become_user: root
  tasks:
    - name: Update apt cache
      apt:
        update_cache: yes
```

## 8. éªŒè¯å®‰è£…
### 8.1 ç‰ˆæœ¬æ£€æŸ¥
```bash
ansible --version
```

### 8.2 è¿æ¥æµ‹è¯•
```bash
# Pingæµ‹è¯•
ansible all -m ping

# æ”¶é›†ä¿¡æ¯
ansible all -m setup
```

## 9. å¸¸è§é—®é¢˜
### 9.1 å®‰è£…é—®é¢˜
- ä¾èµ–ç¼ºå¤±
- ç‰ˆæœ¬å†²çª
- æƒé™ä¸è¶³

### 9.2 é…ç½®é—®é¢˜
- SSHè¿æ¥å¤±è´¥
- sudoæƒé™é—®é¢˜
- Pythonç‰ˆæœ¬ä¸åŒ¹é…

## 10. å‚è€ƒèµ„æ–™
1. [Ansibleå®‰è£…æŒ‡å—](https://docs.ansible.com/ansible/latest/installation_guide/index.html)
2. [Ansibleé…ç½®æ–‡ä»¶](https://docs.ansible.com/ansible/latest/reference_appendices/config.html)
3. [Ansible InventoryæŒ‡å—](https://docs.ansible.com/ansible/latest/user_guide/intro_inventory.html) 