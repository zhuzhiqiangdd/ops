# Ansibleæ¨¡å—å¼€å‘æŒ‡å—

## ç‰ˆæœ¬ä¿¡æ¯
- ç‰ˆæœ¬å·: v1.0.0
- æ›´æ–°æ—¥æœŸ: 2024-03-21
- çŠ¶æ€: [ğŸ—ï¸è¿›è¡Œä¸­]

## 1. æ¦‚è¿°
æœ¬æ–‡æ¡£ä¸»è¦ä»‹ç»Ansibleè‡ªå®šä¹‰æ¨¡å—çš„å¼€å‘æ–¹æ³•å’Œæœ€ä½³å®è·µã€‚

## 2. æ¨¡å—åŸºç¡€
### 2.1 æ¨¡å—ç±»å‹
- æ ¸å¿ƒæ¨¡å—
- æ‰©å±•æ¨¡å—
- è‡ªå®šä¹‰æ¨¡å—

### 2.2 å¼€å‘è¯­è¨€
- Pythonï¼ˆæ¨èï¼‰
- PowerShell
- Shellè„šæœ¬
- Ruby
- Perl

## 3. Pythonæ¨¡å—å¼€å‘
### 3.1 åŸºæœ¬ç»“æ„
```python
#!/usr/bin/python

from ansible.module_utils.basic import AnsibleModule

def main():
    # å®šä¹‰æ¨¡å—å‚æ•°
    module_args = dict(
        name=dict(type='str', required=True),
        state=dict(type='str', default='present', choices=['present', 'absent']),
        port=dict(type='int', default=80)
    )
    
    # åˆ›å»ºæ¨¡å—å®ä¾‹
    module = AnsibleModule(
        argument_spec=module_args,
        supports_check_mode=True
    )
    
    # è·å–å‚æ•°
    name = module.params['name']
    state = module.params['state']
    port = module.params['port']
    
    # æ‰§è¡Œæ“ä½œ
    result = dict(
        changed=False,
        original_message='',
        message=''
    )
    
    # æ£€æŸ¥æ¨¡å¼
    if module.check_mode:
        module.exit_json(**result)
    
    # å®é™…æ‰§è¡Œ
    try:
        # æ‰§è¡Œå…·ä½“æ“ä½œ
        result['changed'] = True
        result['message'] = f'Successfully configured {name} on port {port}'
    except Exception as e:
        module.fail_json(msg=str(e), **result)
    
    # è¿”å›ç»“æœ
    module.exit_json(**result)

if __name__ == '__main__':
    main()
```

### 3.2 å‚æ•°å®šä¹‰
```python
module_args = dict(
    # å­—ç¬¦ä¸²å‚æ•°
    name=dict(type='str', required=True),
    
    # å¸ƒå°”å‚æ•°
    enabled=dict(type='bool', default=True),
    
    # æ•´æ•°å‚æ•°
    port=dict(type='int', default=80),
    
    # åˆ—è¡¨å‚æ•°
    users=dict(type='list', elements='str'),
    
    # å­—å…¸å‚æ•°
    config=dict(type='dict'),
    
    # é€‰é¡¹å‚æ•°
    state=dict(type='str', choices=['present', 'absent']),
    
    # è·¯å¾„å‚æ•°
    path=dict(type='path', required=True)
)
```

## 4. æ¨¡å—åŠŸèƒ½å®ç°
### 4.1 çŠ¶æ€æ£€æŸ¥
```python
def check_status(module):
    name = module.params['name']
    try:
        # æ£€æŸ¥å½“å‰çŠ¶æ€
        current_state = get_current_state(name)
        return current_state
    except Exception as e:
        module.fail_json(msg=f'Error checking status: {str(e)}')
```

### 4.2 å˜æ›´æ‰§è¡Œ
```python
def make_changes(module):
    name = module.params['name']
    state = module.params['state']
    
    try:
        if state == 'present':
            # åˆ›å»ºæˆ–æ›´æ–°
            result = create_or_update(name)
        else:
            # åˆ é™¤
            result = remove(name)
        
        return result
    except Exception as e:
        module.fail_json(msg=f'Error making changes: {str(e)}')
```

## 5. è¾…åŠ©åŠŸèƒ½
### 5.1 å·¥å…·å‡½æ•°
```python
from ansible.module_utils.basic import AnsibleModule
from ansible.module_utils.common.text.converters import to_bytes, to_text

def read_file(module, path):
    try:
        with open(path, 'rb') as f:
            return to_text(f.read())
    except Exception as e:
        module.fail_json(msg=f'Error reading file {path}: {str(e)}')

def write_file(module, path, content):
    try:
        with open(path, 'wb') as f:
            f.write(to_bytes(content))
    except Exception as e:
        module.fail_json(msg=f'Error writing file {path}: {str(e)}')
```

### 5.2 æ—¥å¿—è®°å½•
```python
import logging

def setup_logging(module):
    logging.basicConfig(
        level=logging.INFO,
        format='%(asctime)s - %(levelname)s - %(message)s'
    )
    logger = logging.getLogger('custom_module')
    return logger
```

## 6. æµ‹è¯•å’Œè°ƒè¯•
### 6.1 æœ¬åœ°æµ‹è¯•
```python
def test_module():
    test_args = {
        'name': 'test',
        'state': 'present',
        'port': 8080
    }
    
    module = AnsibleModule(
        argument_spec=module_args,
        supports_check_mode=True
    )
    
    result = main()
    print(result)

if __name__ == '__main__':
    test_module()
```

### 6.2 è°ƒè¯•æŠ€å·§
```python
def debug_info(module, message):
    if module._debug:
        module.debug(message)
```

## 7. æ–‡æ¡£ç¼–å†™
### 7.1 DOCUMENTATION
```python
DOCUMENTATION = '''
---
module: my_custom_module
short_description: è‡ªå®šä¹‰æ¨¡å—ç¤ºä¾‹
description:
    - è¿™æ˜¯ä¸€ä¸ªè‡ªå®šä¹‰æ¨¡å—çš„ç¤ºä¾‹
    - ç”¨äºæ¼”ç¤ºæ¨¡å—å¼€å‘çš„åŸºæœ¬ç»“æ„
version_added: "1.0"
author: "Your Name"
options:
    name:
        description: é…ç½®é¡¹åç§°
        required: true
        type: str
    state:
        description: æœŸæœ›çŠ¶æ€
        choices: [ present, absent ]
        default: present
        type: str
    port:
        description: ç«¯å£å·
        default: 80
        type: int
'''
```

### 7.2 EXAMPLES
```python
EXAMPLES = '''
# åŸºæœ¬ç”¨æ³•
- name: åˆ›å»ºé…ç½®
  my_custom_module:
    name: web_config
    state: present
    port: 8080

# åˆ é™¤é…ç½®
- name: åˆ é™¤é…ç½®
  my_custom_module:
    name: web_config
    state: absent
'''
```

### 7.3 RETURN
```python
RETURN = '''
original_message:
    description: åŸå§‹ä¿¡æ¯
    type: str
    returned: always
message:
    description: æ“ä½œç»“æœä¿¡æ¯
    type: str
    returned: always
'''
```

## 8. æœ€ä½³å®è·µ
### 8.1 ä»£ç è§„èŒƒ
- éµå¾ªPEP 8è§„èŒƒ
- æ·»åŠ é€‚å½“çš„æ³¨é‡Š
- ä½¿ç”¨æœ‰æ„ä¹‰çš„å˜é‡å
- å¤„ç†æ‰€æœ‰å¯èƒ½çš„å¼‚å¸¸

### 8.2 æ€§èƒ½è€ƒè™‘
- é¿å…ä¸å¿…è¦çš„ç³»ç»Ÿè°ƒç”¨
- åˆç†ä½¿ç”¨ç¼“å­˜
- ä¼˜åŒ–å¾ªç¯å’Œç®—æ³•
- å‡å°‘ç½‘ç»œè¯·æ±‚

## 9. å¸¸è§é—®é¢˜
### 9.1 è°ƒè¯•é—®é¢˜
- å‚æ•°è§£æé”™è¯¯
- æƒé™é—®é¢˜
- è·¯å¾„é—®é¢˜
- ç¼–ç é—®é¢˜

### 9.2 å…¼å®¹æ€§é—®é¢˜
- Pythonç‰ˆæœ¬å…¼å®¹
- æ“ä½œç³»ç»Ÿå…¼å®¹
- Ansibleç‰ˆæœ¬å…¼å®¹

## 10. å‚è€ƒèµ„æ–™
1. [Ansibleæ¨¡å—å¼€å‘æŒ‡å—](https://docs.ansible.com/ansible/latest/dev_guide/developing_modules_general.html)
2. [Ansibleæ¨¡å—ç¤ºä¾‹](https://github.com/ansible/ansible/tree/devel/lib/ansible/modules)
3. [Pythonç¼–ç è§„èŒƒ](https://www.python.org/dev/peps/pep-0008/) 