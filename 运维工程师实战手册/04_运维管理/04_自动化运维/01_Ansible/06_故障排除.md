# Ansibleæ•…éšœæ’é™¤æŒ‡å—

## ç‰ˆæœ¬ä¿¡æ¯
- ç‰ˆæœ¬å·: v1.0.0
- æ›´æ–°æ—¥æœŸ: 2024-03-21
- çŠ¶æ€: [ğŸ—ï¸è¿›è¡Œä¸­]

## 1. æ¦‚è¿°
æœ¬æ–‡æ¡£ä¸»è¦ä»‹ç»Ansibleä½¿ç”¨è¿‡ç¨‹ä¸­å¸¸è§é—®é¢˜çš„æ’æŸ¥å’Œè§£å†³æ–¹æ³•ã€‚

## 2. è¿æ¥é—®é¢˜
### 2.1 SSHè¿æ¥å¤±è´¥
```bash
# é”™è¯¯ä¿¡æ¯
"msg": "Failed to connect to the host via ssh: Permission denied (publickey,password)"

# è§£å†³æ–¹æ³•
# 1. æ£€æŸ¥SSHå¯†é’¥
ssh-copy-id user@remote-host

# 2. æ£€æŸ¥æƒé™
chmod 600 ~/.ssh/id_rsa
chmod 700 ~/.ssh

# 3. æ£€æŸ¥known_hosts
ssh-keyscan remote-host >> ~/.ssh/known_hosts
```

### 2.2 è¶…æ—¶é—®é¢˜
```ini
# ansible.cfg
[defaults]
timeout = 30

[ssh_connection]
ssh_args = -o ConnectTimeout=30
```

## 3. æƒé™é—®é¢˜
### 3.1 sudoæƒé™
```yaml
# é”™è¯¯ä¿¡æ¯
"msg": "Missing sudo password"

# è§£å†³æ–¹æ³•
# 1. é…ç½®æ— å¯†ç sudo
- hosts: webservers
  become: yes
  become_method: sudo
  become_user: root
  
# 2. ä½¿ç”¨sudoå¯†ç 
ansible-playbook site.yml --ask-become-pass
```

### 3.2 æ–‡ä»¶æƒé™
```yaml
# é”™è¯¯ä¿¡æ¯
"msg": "Permission denied"

# è§£å†³æ–¹æ³•
- name: ç¡®ä¿ç›®å½•å­˜åœ¨
  file:
    path: /var/www/html
    state: directory
    mode: '0755'
    owner: www-data
    group: www-data
```

## 4. Pythoné—®é¢˜
### 4.1 Pythonç‰ˆæœ¬
```yaml
# é”™è¯¯ä¿¡æ¯
"msg": "Python not found"

# è§£å†³æ–¹æ³•
# 1. æŒ‡å®šPythonè§£é‡Šå™¨
ansible_python_interpreter: /usr/bin/python3

# 2. å®‰è£…Python
- name: å®‰è£…Python
  raw: apt-get update && apt-get install -y python3
```

### 4.2 æ¨¡å—ä¾èµ–
```yaml
# é”™è¯¯ä¿¡æ¯
"msg": "No module named 'yaml'"

# è§£å†³æ–¹æ³•
- name: å®‰è£…Pythonä¾èµ–
  pip:
    name:
      - pyyaml
      - jinja2
    state: present
```

## 5. å˜é‡é—®é¢˜
### 5.1 å˜é‡æœªå®šä¹‰
```yaml
# é”™è¯¯ä¿¡æ¯
"msg": "The task includes an option with an undefined variable"

# è§£å†³æ–¹æ³•
# 1. è®¾ç½®é»˜è®¤å€¼
{{ variable | default('default_value') }}

# 2. æ£€æŸ¥å˜é‡æ˜¯å¦å®šä¹‰
- name: æ£€æŸ¥å˜é‡
  debug:
    msg: "{{ variable }}"
  when: variable is defined
```

### 5.2 å˜é‡ä½œç”¨åŸŸ
```yaml
# 1. ä½¿ç”¨set_fact
- set_fact:
    my_var: "value"

# 2. æ³¨å†Œå˜é‡
- command: whoami
  register: user_info
```

## 6. ä»»åŠ¡æ‰§è¡Œé—®é¢˜
### 6.1 ä»»åŠ¡å¤±è´¥
```yaml
# é”™è¯¯å¤„ç†
- name: æ‰§è¡Œé£é™©æ“ä½œ
  command: risky_command
  ignore_errors: yes
  register: command_result
  
- name: æ£€æŸ¥ç»“æœ
  debug:
    var: command_result
  when: command_result.failed
```

### 6.2 å¹‚ç­‰æ€§é—®é¢˜
```yaml
# ç¡®ä¿å¹‚ç­‰æ€§
- name: åˆ›å»ºç”¨æˆ·
  user:
    name: myuser
    state: present
  register: user_result
  
- name: æ˜¾ç¤ºç»“æœ
  debug:
    msg: "ç”¨æˆ·å·²å­˜åœ¨"
  when: not user_result.changed
```

## 7. ç½‘ç»œé—®é¢˜
### 7.1 ä»£ç†è®¾ç½®
```ini
# ansible.cfg
[defaults]
proxy_server = http://proxy.example.com:8080

# æˆ–è€…ä½¿ç”¨ç¯å¢ƒå˜é‡
export http_proxy=http://proxy.example.com:8080
export https_proxy=http://proxy.example.com:8080
```

### 7.2 DNSè§£æ
```ini
# inventory
web1 ansible_host=192.168.1.10
web2 ansible_host=192.168.1.11
```

## 8. æ€§èƒ½é—®é¢˜
### 8.1 æ‰§è¡Œæ…¢
```ini
# ansible.cfg
[defaults]
# å¢åŠ å¹¶è¡Œæ•°
forks = 20

# å¯ç”¨ç®¡é“æ¨¡å¼
pipelining = True

# ç¦ç”¨äº‹å®æ”¶é›†
gathering = explicit
```

### 8.2 å†…å­˜é—®é¢˜
```yaml
# æ§åˆ¶äº‹å®ç¼“å­˜
- hosts: all
  gather_facts: no
  
# ä½¿ç”¨äº‹å®ç¼“å­˜
[defaults]
fact_caching = jsonfile
fact_caching_connection = /tmp/ansible_facts
fact_caching_timeout = 86400
```

## 9. è°ƒè¯•æŠ€å·§
### 9.1 è°ƒè¯•æ¨¡å¼
```bash
# æ˜¾ç¤ºè¯¦ç»†ä¿¡æ¯
ansible-playbook site.yml -vvv

# åˆ—å‡ºä¸»æœº
ansible all --list-hosts

# æµ‹è¯•è¿æ¥
ansible all -m ping
```

### 9.2 æ£€æŸ¥æ¨¡å¼
```bash
# è¯­æ³•æ£€æŸ¥
ansible-playbook site.yml --syntax-check

# æµ‹è¯•è¿è¡Œ
ansible-playbook site.yml --check

# åˆ—å‡ºä»»åŠ¡
ansible-playbook site.yml --list-tasks
```

## 10. æ—¥å¿—åˆ†æ
### 10.1 å¯ç”¨æ—¥å¿—
```ini
# ansible.cfg
[defaults]
log_path = /var/log/ansible.log
```

### 10.2 æ—¥å¿—çº§åˆ«
```ini
# ansible.cfg
[defaults]
verbosity = 2
```

## 11. å¸¸è§é”™è¯¯ç 
### 11.1 è¿”å›ç è¯´æ˜
- 0: æˆåŠŸ
- 1: å¤±è´¥
- 2: è§£æé”™è¯¯
- 3: å‚æ•°é”™è¯¯
- 4: è¿æ¥é”™è¯¯
- 5: æƒé™é”™è¯¯

### 11.2 é”™è¯¯å¤„ç†
```yaml
- name: æ‰§è¡Œå‘½ä»¤
  command: my_command
  register: result
  failed_when: result.rc != 0 or 'Error' in result.stderr
```

## 12. å‚è€ƒèµ„æ–™
1. [Ansibleæ•…éšœæ’é™¤](https://docs.ansible.com/ansible/latest/user_guide/troubleshooting.html)
2. [Ansibleè°ƒè¯•æŒ‡å—](https://docs.ansible.com/ansible/latest/user_guide/playbooks_debugger.html)
3. [Ansibleå¸¸è§é—®é¢˜](https://docs.ansible.com/ansible/latest/reference_appendices/common_return_values.html) 