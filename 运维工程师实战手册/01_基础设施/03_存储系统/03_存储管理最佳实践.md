# å­˜å‚¨ç®¡ç†æœ€ä½³å®è·µ

## æ–‡æ¡£ä¿¡æ¯
- ç‰ˆæœ¬: v1.0.0
- æ›´æ–°æ—¶é—´: 2024-03-21
- çŠ¶æ€: [ğŸ—ï¸è¿›è¡Œä¸­]
- ä½œè€…: System Admin

## ä¿®è®¢å†å²
| ç‰ˆæœ¬ | æ—¥æœŸ | æè¿° | ä½œè€… |
|-----|------|-----|-----|
| v1.0.0 | 2024-03-21 | åˆå§‹ç‰ˆæœ¬ | System Admin |

## æ–‡æ¡£è¯´æ˜
### ç›®æ ‡è¯»è€…
- ç³»ç»Ÿç®¡ç†å‘˜
- å­˜å‚¨å·¥ç¨‹å¸ˆ
- è¿ç»´å·¥ç¨‹å¸ˆ
- æŠ€æœ¯ç»ç†

### å‰ç½®çŸ¥è¯†
- å­˜å‚¨ç³»ç»ŸåŸºç¡€
- æ€§èƒ½ä¼˜åŒ–åŸç†
- è¿ç»´ç®¡ç†ç»éªŒ
- æ•…éšœå¤„ç†èƒ½åŠ›

## å­˜å‚¨è§„åˆ’
### å®¹é‡è§„åˆ’
1. å®¹é‡è¯„ä¼°
   - å½“å‰ä½¿ç”¨é‡
   - å¢é•¿è¶‹åŠ¿
   - å³°å€¼é¢„æµ‹
   - å†—ä½™éœ€æ±‚

2. æˆæœ¬æ§åˆ¶
   - ç¡¬ä»¶æˆæœ¬
   - è¿ç»´æˆæœ¬
   - æ‰©å±•æˆæœ¬
   - ROIåˆ†æ

### æ¶æ„è§„åˆ’
1. åˆ†å±‚å­˜å‚¨
   ```
   é«˜æ€§èƒ½å±‚ï¼ˆSSDï¼‰
   â”œâ”€â”€ å…³é”®ä¸šåŠ¡æ•°æ®
   â”œâ”€â”€ é«˜é¢‘è®¿é—®æ•°æ®
   â””â”€â”€ æ•°æ®åº“å­˜å‚¨

   æ™®é€šå­˜å‚¨å±‚ï¼ˆHDDï¼‰
   â”œâ”€â”€ ä¸€èˆ¬ä¸šåŠ¡æ•°æ®
   â”œâ”€â”€ ä½é¢‘è®¿é—®æ•°æ®
   â””â”€â”€ æ–‡æ¡£å­˜å‚¨

   å½’æ¡£å­˜å‚¨å±‚
   â”œâ”€â”€ å†å²æ•°æ®
   â”œâ”€â”€ å¤‡ä»½æ•°æ®
   â””â”€â”€ åˆè§„æ•°æ®
   ```

2. ç½‘ç»œè§„åˆ’
   ```
   å­˜å‚¨ç½‘ç»œæ¶æ„
   â”œâ”€â”€ ç®¡ç†ç½‘ç»œï¼ˆ1GbEï¼‰
   â”œâ”€â”€ ç”Ÿäº§ç½‘ç»œï¼ˆ10GbEï¼‰
   â””â”€â”€ å¤‡ä»½ç½‘ç»œï¼ˆ10GbEï¼‰

   ç½‘ç»œå†—ä½™
   â”œâ”€â”€ åŒäº¤æ¢æœº
   â”œâ”€â”€ å¤šè·¯å¾„
   â””â”€â”€ é“¾è·¯èšåˆ
   ```

## æ€§èƒ½ä¼˜åŒ–
### ç¡¬ä»¶ä¼˜åŒ–
1. å­˜å‚¨ä»‹è´¨é€‰æ‹©
   - ä¼ä¸šçº§SSD
   - SASç¡¬ç›˜
   - SATAç¡¬ç›˜
   - æ··åˆå­˜å‚¨

2. RAIDä¼˜åŒ–
```bash
# RAIDé…ç½®ä¼˜åŒ–
# æ¡å¸¦å¤§å°é€‰æ‹©
mdadm --create /dev/md0 --level=10 --raid-devices=4 \
      --chunk=256 /dev/sd[b-e]1

# è¯»å†™ç­–ç•¥è®¾ç½®
echo write-back > /sys/block/md0/md/stripe_cache_size
```

### ç³»ç»Ÿä¼˜åŒ–
1. IOè°ƒåº¦ä¼˜åŒ–
```bash
# è®¾ç½®IOè°ƒåº¦å™¨
echo deadline > /sys/block/sda/queue/scheduler

# è°ƒæ•´é˜Ÿåˆ—æ·±åº¦
echo 1024 > /sys/block/sda/queue/nr_requests

# é¢„è¯»è®¾ç½®
blockdev --setra 4096 /dev/sda
```

2. æ–‡ä»¶ç³»ç»Ÿä¼˜åŒ–
```bash
# ext4ä¼˜åŒ–
tune2fs -o journal_data_writeback /dev/sda1
mount -o noatime,nodiratime,data=writeback /dev/sda1 /data

# XFSä¼˜åŒ–
mount -o noatime,nodiratime,logbufs=8 /dev/sda1 /data
```

### ç¼“å­˜ä¼˜åŒ–
1. ç³»ç»Ÿç¼“å­˜
```bash
# è°ƒæ•´ç³»ç»Ÿç¼“å­˜
echo 3 > /proc/sys/vm/drop_caches
echo 60 > /proc/sys/vm/swappiness

# IOç¼“å­˜
echo 1024 > /sys/block/sda/queue/read_ahead_kb
```

2. åº”ç”¨ç¼“å­˜
```nginx
# Nginxç¼“å­˜é…ç½®
proxy_cache_path /data/nginx/cache levels=1:2 
    keys_zone=mycache:10m max_size=10g inactive=60m;
proxy_buffer_size 16k;
proxy_buffers 4 64k;
```

## ç›‘æ§ç®¡ç†
### æ€§èƒ½ç›‘æ§
1. IOç›‘æ§
```bash
# iostatç›‘æ§
iostat -x 1
# è¾“å‡ºåˆ†æ
# %util > 80%ï¼šIOç“¶é¢ˆ
# await > 20msï¼šå“åº”å»¶è¿Ÿ
# r/s + w/s > 1000ï¼šé«˜IOè´Ÿè½½

# iotopç›‘æ§
iotop -o -P
```

2. å®¹é‡ç›‘æ§
```bash
# ç£ç›˜ä½¿ç”¨ç›‘æ§
df -h
# å‘Šè­¦é˜ˆå€¼ï¼šä½¿ç”¨ç‡>85%

# ç›®å½•ä½¿ç”¨ç›‘æ§
du -sh /*
# å¤§æ–‡ä»¶æŸ¥æ‰¾
find / -type f -size +100M -exec ls -lh {} \;
```

### å‘Šè­¦é…ç½®
1. ç›‘æ§è„šæœ¬
```bash
#!/bin/bash
# å­˜å‚¨ç›‘æ§è„šæœ¬
THRESHOLD=85
ADMIN_MAIL="admin@example.com"

# æ£€æŸ¥ç£ç›˜ä½¿ç”¨ç‡
df -h | awk '{print $5}' | grep -v Use | while read output;
do
    usage=${output%?}
    if [ $usage -ge $THRESHOLD ]; then
        echo "Disk usage above threshold!" | mail -s "Storage Alert" $ADMIN_MAIL
    fi
done

# æ£€æŸ¥RAIDçŠ¶æ€
if ! grep -q "UU" /proc/mdstat; then
    echo "RAID array degraded!" | mail -s "RAID Alert" $ADMIN_MAIL
fi
```

2. ç›‘æ§ç³»ç»Ÿé›†æˆ
```yaml
# Prometheuså­˜å‚¨ç›‘æ§
- job_name: 'node_exporter'
  static_configs:
    - targets: ['localhost:9100']

  relabel_configs:
    - source_labels: [__address__]
      regex: '(.*):'
      target_label: instance
      replacement: '${1}'

# Grafanaå‘Šè­¦è§„åˆ™
- alert: HighStorageUsage
  expr: node_filesystem_avail_bytes{mountpoint="/"} / node_filesystem_size_bytes{mountpoint="/"} * 100 < 15
  for: 5m
  labels:
    severity: warning
  annotations:
    summary: "High storage usage (instance {{ $labels.instance }})"
    description: "Storage usage is above 85%"
```

## å®‰å…¨ç®¡ç†
### è®¿é—®æ§åˆ¶
1. æƒé™ç®¡ç†
```bash
# æ–‡ä»¶æƒé™
chmod 750 /data
chown -R storage:storage /data

# ACLé…ç½®
setfacl -m u:user1:rx /data
setfacl -m g:group1:rwx /data

# é…ç½®å®¡è®¡
auditctl -w /data -p wa -k data_access
```

2. è®¤è¯æˆæƒ
```bash
# NFSæƒé™
# /etc/exports
/data *(rw,sync,no_root_squash,no_subtree_check)

# iSCSIè®¤è¯
# /etc/tgt/targets.conf
<target iqn.2024-03.com.example:storage.disk1>
    backing-store /dev/sdb
    initiator-address 192.168.1.0/24
    incominguser username password
</target>
```

### æ•°æ®å®‰å…¨
1. åŠ å¯†é…ç½®
```bash
# ç£ç›˜åŠ å¯†
cryptsetup luksFormat /dev/sdb1
cryptsetup luksOpen /dev/sdb1 secure_storage
mkfs.ext4 /dev/mapper/secure_storage

# ä¼ è¾“åŠ å¯†
# SSHéš§é“
ssh -L 3260:localhost:3260 storage_server
```

2. å®‰å…¨å®¡è®¡
```bash
# å®¡è®¡é…ç½®
# /etc/audit/rules.d/audit.rules
-w /data -p wa -k storage_access
-w /etc/exports -p wa -k nfs_config
-w /etc/tgt -p wa -k iscsi_config

# æ—¥å¿—åˆ†æ
ausearch -k storage_access
```

## æ•…éšœå¤„ç†
### å¸¸è§æ•…éšœ
1. æ€§èƒ½é—®é¢˜
   - IOç“¶é¢ˆ
   - å“åº”å»¶è¿Ÿ
   - é˜Ÿåˆ—å †ç§¯
   - ç¼“å­˜å¤±æ•ˆ

2. å®¹é‡é—®é¢˜
   - ç©ºé—´è€—å°½
   - ç¢ç‰‡åŒ–
   - inodeè€—å°½
   - é…é¢è¶…é™

### å¤„ç†æµç¨‹
1. æ•…éšœå®šä½
```bash
# IOé—®é¢˜å®šä½
iostat -x 1
iotop -o
pidstat -d 1

# å®¹é‡é—®é¢˜å®šä½
df -i
lsof +L1
find / -xdev -type f -size +100M
```

2. åº”æ€¥å¤„ç†
```bash
# ç´§æ€¥é‡Šæ”¾ç©ºé—´
find /var/log -type f -name "*.log" -mtime +30 -delete
journalctl --vacuum-size=500M

# IOè´Ÿè½½æ§åˆ¶
ionice -c 2 -n 7 -p $(pidof high_io_process)
```

## è¿ç»´ç®¡ç†
### æ—¥å¸¸ç»´æŠ¤
1. å®šæœŸæ£€æŸ¥
```bash
# æ–‡ä»¶ç³»ç»Ÿæ£€æŸ¥
fsck -f /dev/sda1
xfs_repair /dev/sdb1

# RAIDæ£€æŸ¥
mdadm --detail /dev/md0
smartctl -a /dev/sda
```

2. æ€§èƒ½ä¼˜åŒ–
```bash
# ç¢ç‰‡æ•´ç†
e4defrag /data
xfs_fsr /data

# ç¼“å­˜æ¸…ç†
echo 3 > /proc/sys/vm/drop_caches
sysctl -w vm.drop_caches=3
```

### å˜æ›´ç®¡ç†
1. æ‰©å®¹æµç¨‹
```bash
# LVMæ‰©å®¹
pvcreate /dev/sdc1
vgextend vg_data /dev/sdc1
lvextend -L +100G /dev/vg_data/lv_data
resize2fs /dev/vg_data/lv_data

# åœ¨çº¿è¿ç§»
rsync -avz --progress /data/ /new_data/
```

2. é…ç½®å˜æ›´
```bash
# é…ç½®å¤‡ä»½
cp /etc/exports /etc/exports.bak
tar czf /backup/storage_conf_$(date +%Y%m%d).tar.gz /etc/storage/

# å˜æ›´è®°å½•
logger -t storage_change "Changed storage configuration: $CHANGE_DETAILS"
```

## æœ€ä½³å®è·µ
### è®¾è®¡å»ºè®®
1. æ¶æ„è®¾è®¡
   - åˆ†å±‚å­˜å‚¨æ¶æ„
   - é«˜å¯ç”¨è®¾è®¡
   - ç¾å¤‡è®¾è®¡
   - æ‰©å±•è®¾è®¡

2. æ€§èƒ½è®¾è®¡
   - IOPSè§„åˆ’
   - å¸¦å®½è§„åˆ’
   - å»¶è¿Ÿè¦æ±‚
   - å¹¶å‘å¤„ç†

### è¿ç»´å»ºè®®
1. æ—¥å¸¸è¿ç»´
   - æ ‡å‡†åŒ–æ“ä½œ
   - è‡ªåŠ¨åŒ–ç®¡ç†
   - é¢„é˜²æ€§ç»´æŠ¤
   - æŒç»­ä¼˜åŒ–

2. åº”æ€¥å“åº”
   - é¢„æ¡ˆå‡†å¤‡
   - å¿«é€Ÿå“åº”
   - æ ¹å› åˆ†æ
   - ç»éªŒæ€»ç»“

## å‚è€ƒèµ„æ–™
- [Linuxå­˜å‚¨ç®¡ç†æŒ‡å—](https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/8/html/managing_storage_devices/index)
- [å­˜å‚¨æ€§èƒ½ä¼˜åŒ–æŒ‡å—](https://www.snia.org/education/storage_networking_primer)
- [å­˜å‚¨å®‰å…¨æœ€ä½³å®è·µ](https://www.snia.org/education/storage_security)

## ç›¸å…³æ–‡æ¡£
- [å­˜å‚¨æ–¹æ¡ˆè®¾è®¡](./01_å­˜å‚¨æ–¹æ¡ˆè®¾è®¡.md)
- [å¤‡ä»½ç³»ç»Ÿå®æ–½](./02_å¤‡ä»½ç³»ç»Ÿå®æ–½.md) 